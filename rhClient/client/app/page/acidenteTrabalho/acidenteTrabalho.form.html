<div class="page" ng-controller="acidenteTrabalhoFormCtrl">
    <div class="row ui-section">
        <div class="col-lg-8 clearfix">
            <h2 class="section-header">{{!detalhes ? 'Formulário de Acidente de Trabalho' : 'Detalhes de Acidente de
                Trabalho'}}</h2>
        </div>
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-lg-8 col-lg-offset-2">
                            <form ng-disabled="detalhes" name="acidenteTrabalhoForm" ng-submit="save()">
                                <div layout="column" ng-cloak class="md-inline-form inputdemoBasicUsage">
                                    <div layout-padding>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <md-autocomplete md-input-name="funcionario" ng-required="true"
                                                    ng-disabled="detalhes" md-no-cache="acidenteTrabalhoForm.noCache"
                                                    md-selected-item="acidenteTrabalho.funcionario"
                                                    md-search-text="acidenteTrabalhoForm.searchBuscaFuncionario"
                                                    md-items="item in querySearchFuncionario(acidenteTrabalhoForm.searchBuscaFuncionario)"
                                                    md-item-text="item.nome" md-delay="100" md-min-length="3"
                                                    md-floating-label="Funcionário" md-require-match>
                                                    <md-item-template>
                                                        <span
                                                            md-highlight-text="acidenteTrabalhoForm.searchBuscaFuncionario"
                                                            md-highlight-flags="^i">
                                                            {{item.nome}}</span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        Item
                                                        "{{acidenteTrabalhoForm.searchBuscaFuncionario}}"
                                                        não
                                                        encontrado.
                                                    </md-not-found>
                                                    <div ng-messages="acidenteTrabalhoForm.funcionario.$error">
                                                        <div ng-message="required">Campo de preenchimento obrigatório.
                                                        </div>
                                                    </div>
                                                </md-autocomplete>
                                            </div>
                                        </div>

                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Aviso</label>
                                                <input ng-disabled="detalhes" ui-number-mask="0" ng-required="true"
                                                    ng-model="acidenteTrabalho.aviso" name="aviso">
                                                <div ng-messages="acidenteTrabalhoForm.aviso.$error" multiple>
                                                    <div ng-message="required">Campo de preenchimento
                                                        obrigatório.</div>
                                                </div>
                                            </md-input-container>
                                            <md-input-container flex>
                                                <label>Setor / Local</label>
                                                <input ng-disabled="detalhes" ng-required="true"
                                                    ng-model="acidenteTrabalho.setorLocal" name="setorLocal">
                                                <div ng-messages="acidenteTrabalhoForm.setorLocal.$error" multiple>
                                                    <div ng-message="required">Campo de preenchimento
                                                        obrigatório.</div>
                                                </div>
                                            </md-input-container>
                                        </div>

                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Causa</label>
                                                <input ng-disabled="detalhes" ng-required="true"
                                                    ng-model="acidenteTrabalho.causa" name="causa">
                                                <div ng-messages="acidenteTrabalhoForm.causa.$error" multiple>
                                                    <div ng-message="required">Campo de preenchimento
                                                        obrigatório.</div>
                                                </div>
                                            </md-input-container>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <md-autocomplete md-input-name="entidade" ng-disabled="detalhes"
                                                    md-no-cache="acidenteTrabalhoForm.noCache"
                                                    md-selected-item="acidenteTrabalho.entidade"
                                                    md-search-text="acidenteTrabalhoForm.searchBuscaEntidade"
                                                    md-items="item in querySearchTomadorServico(acidenteTrabalhoForm.searchBuscaEntidade)"
                                                    md-item-text="item.razaoSocial" md-delay="100" md-min-length="3"
                                                    md-floating-label="Entidade" md-require-match>
                                                    <md-item-template>
                                                        <span
                                                            md-highlight-text="acidenteTrabalhoForm.searchBuscaEntidade"
                                                            md-highlight-flags="^i">
                                                            {{item.razaoSocial}}</span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        Item
                                                        "{{acidenteTrabalhoForm.searchBuscaEntidade}}"
                                                        não
                                                        encontrado.
                                                    </md-not-found>
                                                    <div ng-messages="acidenteTrabalhoForm.entidade.$error">
                                                        <div ng-message="required">Campo de preenchimento obrigatório.
                                                        </div>
                                                    </div>
                                                </md-autocomplete>
                                            </div>
                                            <div class="col-md-6">
                                                <md-autocomplete md-input-name="tomadorServico" ng-disabled="detalhes"
                                                    md-no-cache="acidenteTrabalhoForm.noCache"
                                                    md-selected-item="acidenteTrabalho.tomadorServico"
                                                    md-search-text="acidenteTrabalhoForm.searchBuscaTomadorServico"
                                                    md-items="item in querySearchTomadorServico(acidenteTrabalhoForm.searchBuscaTomadorServico)"
                                                    md-item-text="item.razaoSocial" md-delay="100" md-min-length="3"
                                                    md-floating-label="Tomador de Serviço" md-require-match>
                                                    <md-item-template>
                                                        <span
                                                            md-highlight-text="acidenteTrabalhoForm.searchBuscaTomadorServico"
                                                            md-highlight-flags="^i">
                                                            {{item.razaoSocial}}</span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        Item
                                                        "{{acidenteTrabalhoForm.searchBuscaTomadorServico}}"
                                                        não
                                                        encontrado.
                                                    </md-not-found>
                                                    <div ng-messages="acidenteTrabalhoForm.tomadorServico.$error">
                                                        <div ng-message="required">Campo de preenchimento obrigatório.
                                                        </div>
                                                    </div>
                                                </md-autocomplete>
                                            </div>
                                        </div>

                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Data e hora do acidente</label>
                                                <md-icon class="material-icons icon-momentpicker"
                                                    ng-class="md-datepicker-calendar-icon" aria-label="md-calendar">
                                                    date_range</md-icon>
                                                <input name="dataHoraAcidente" ng-required="true"
                                                    moment-picker="acidenteTrabalho.dataHoraAcidente"
                                                    placeholder="Selecione a data e a hora"
                                                    ng-model="acidenteTrabalho.dataHoraAcidente" format="DD/MM/YYYY"
                                                    locale="pt-br" start-view="month"
                                                    ng-model-options="{ updateOn: 'blur' }" ng-disabled="detalhes">
                                            </md-input-container>
                                        </div>
                                    </div>

                                    <h4>Afastamento</h4>
                                    <div layout-padding>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Dias afastados</label>
                                                <input ng-disabled="detalhes" ui-number-mask="0" ng-required="true"
                                                    ng-model="acidenteTrabalho.diasAfastado" name="diasAfastado">
                                                <div ng-messages="acidenteTrabalhoForm.diasAfastado.$error" multiple>
                                                    <div ng-message="required">Campo de preenchimento
                                                        obrigatório.</div>
                                                </div>
                                            </md-input-container>
                                            <md-input-container flex>
                                                <label>Numero do CAT</label>
                                                <input ng-disabled="detalhes" ui-number-mask="0" ng-required="true"
                                                    ng-model="acidenteTrabalho.numeroCat" name="numeroCat">
                                                <div ng-messages="acidenteTrabalhoForm.numeroCat.$error" multiple>
                                                    <div ng-message="required">Campo de preenchimento
                                                        obrigatório.</div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Data prevista de volta</label>
                                                <md-icon class="material-icons icon-momentpicker"
                                                    ng-class="md-datepicker-calendar-icon" aria-label="md-calendar">
                                                    date_range</md-icon>
                                                <input name="dataPrevistaVolta" ng-required="true"
                                                    moment-picker="acidenteTrabalho.dataPrevistaVolta"
                                                    placeholder="Selecione a data e a hora"
                                                    ng-model="acidenteTrabalho.dataPrevistaVolta" format="DD/MM/YYYY"
                                                    locale="pt-br" start-view="month"
                                                    ng-model-options="{ updateOn: 'blur' }" ng-disabled="detalhes">
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <md-switch ng-disabled="detalhes" name="documentoEmitido"
                                                    ng-model="acidenteTrabalho.documentoEmitido" aria-label="Ativo">
                                                    Documento emitido
                                                </md-switch>
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Data emissão do documento</label>
                                                <md-icon class="material-icons icon-momentpicker"
                                                    ng-class="md-datepicker-calendar-icon" aria-label="md-calendar">
                                                    date_range</md-icon>
                                                <input name="dataEmissaoDocumento"
                                                    moment-picker="acidenteTrabalho.dataEmissaoDocumento"
                                                    placeholder="Selecione a data"
                                                    ng-model="acidenteTrabalho.dataEmissaoDocumento" format="DD/MM/YYYY"
                                                    locale="pt-br" start-view="month"
                                                    ng-model-options="{ updateOn: 'blur' }" ng-disabled="detalhes">
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Resultado</label>
                                                <input ng-disabled="detalhes" ng-model="acidenteTrabalho.resultado"
                                                    name="resultado">
                                            </md-input-container>
                                        </div>
                                    </div>

                                    <h2 class="md-title">Anexo {{acidenteTrabalho.anexo.id && !detalhes}}</h2>
                                    <div class="col-md-12">
                                        <div layout layout-sm="column">
                                            <md-input-container flex ng-if="!acidenteTrabalho.anexo.id">
                                                <input ng-disabled="detalhes" type="file" nv-file-select
                                                    uploader="uploader" file-on-change="onFileChange"
                                                    accept=".png, .jpeg, .pdf" />
                                            </md-input-container>
                                            <md-input-container flex ng-if="acidenteTrabalho.anexo.id">
                                                <a href="{{acidenteTrabalho.anexo.fileDownloadUri}}"
                                                    target="_blank">{{acidenteTrabalho.anexo.fileName}}</a>
                                            </md-input-container>
                                            <md-input-container class="md-block"
                                                ng-if="acidenteTrabalho.anexo.id && !detalhes">
                                                <a href="" ng-click="excluirAnexo()">
                                                    <md-tooltip md-direction="top">Excluir arquivo</md-tooltip>
                                                    <i class="fa fa-trash fa-lg"></i>
                                                </a>
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Descrição</label>
                                                <textarea name="observacao" type="text"
                                                    ng-disabled="!acidenteTrabalho.anexo || detalhes"
                                                    ng-model="acidenteTrabalho.anexo.description">
                                                        </textarea>
                                            </md-input-container>
                                        </div>
                                    </div>


                                    <div layout-padding>
                                        <div ng-if="detalhes" layout layout-sm="column">
                                            <table md-table md-progress="promise">
                                                <thead md-head>
                                                    <tr md-row>
                                                        <th md-column>
                                                            <span>Criado em:</span>
                                                        </th>
                                                        <th md-column>
                                                            <span>Atualizado em:</span>
                                                        </th>
                                                        <th md-column>
                                                            <span>Criado por:</span>
                                                        </th>
                                                        <th md-column>
                                                            <span>Atualizado por:</span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody md-body>
                                                    <tr md-row>
                                                        <td md-cell>{{acidenteTrabalho.criadoEm | date:'dd/MM/yy -
                                                        HH:mm'}}</td>
                                                        <td md-cell>{{acidenteTrabalho.alteradoEm | date:'dd/MM/yy -
                                                        HH:mm'}}</td>
                                                        <td md-cell>{{acidenteTrabalho.criadoPor}}</td>
                                                        <td md-cell>{{acidenteTrabalho.alteradoPor}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="row" style="margin: 50px">
                                        <div class="col-md-12 text-center">
                                            <button ng-if="!detalhes" ng-disabled="acidenteTrabalhoForm.$invalid"
                                                type="submit" ui-wave class="btn btn-primary btn-w-md">Salvar</button>
                                            <p class="btn btn-default btn-w-md" ui-wave data-ng-click="goBack()">Voltar
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>